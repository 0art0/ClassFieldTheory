\chapter{Global Class Field Theory}

In this chapter we let $l/k$ be a finite Galois extension of
algebraic number fields. We shall consider the idele class group $\Cl_l = \A_l^\times / l^\times$
as a module for the Galois group $\Gal(l/k)$ and we shall describe the construction of
fundamental classes in $H^2(l/k, \Cl_l)$.
These classes give rise to a reciprocity isomorphism
\[
	\Gal(l/k)^{ab} \cong \Cl_k / N(\Cl_l).
\]
We would therefore like to prove for all intermediate fields $l / m / k$:
\begin{itemize}
	\item
	$H^1(l/m, \Cl_l) = 0$,
	\item
	$H^2(l/m, \Cl_l)$ is cyclic of order $[l:m]$.
\end{itemize}

We note the following consequence of Hilbert's theorem 90:

\begin{lemma} \label{lem:idele class invariants}
	\uses{thm:hilbert 90}
	Let $l/k$ be any Galois extension of number fields.
	The map $\Cl_k \to \Cl_l ^ {\Gal(l/k)}$ is an isomorphism.
\end{lemma}

\begin{proof}
	We have a short exact sequence
	\[
		0 \to l^\times \to \A_l^\times \to \Cl_l \to 0.
	\]
	Taking $\Gal(l/k)$-invariants gives a long exact sequence beginning with
	\[
		0 \to k^\times \to \A_k^\times \to \Cl_l^{\Gal(l/k)} \to H^1(l/k, l^\times).
	\]
	The last term is zero by \ref{thm:hilbert 90}. This implies the result.
\end{proof}

By the lemma, the inflation map for a tower of Galois extensions $l/m/k$ takes the form
\[
	H^n(m/k, \Cl_m) \to H^n(l/k, \Cl_l).
\]






\section{Choice of $S$}

Let $S$ be a finite set of places of $k$, containing all of the infinite primes and all
of the primes which ramify in $l$.
We shall use the notation
\[
	\A_{l,S} = \prod_{v \in S} \prod_{w | v} l_w \times \prod_{v \in S} \prod_{w | v} \cO_v.
\]
We also write $\cO_{l,S}$ for the $S$-integers in $l$:
\[
	\cO_{l,S} = \{x \in l, \forall v \not\in S, \forall w | v, |x|_v \le 1\} = k \cap \A_{l,S}.
\]
We regard $\cO_{l,S}$ as a subring of $\A_{l,S}$ and
$\cO_{l,S}^\times$ as a subgroup of $\A_{l,S}^\times$.

By adding more primes to $S$ if necessary, we may assume that $\cO_{k,S}$ and $\cO_{l,S}$ are both
principal ideal domains (that can be achieved by adding to $S$ the primes $P$ whose ideal classes
generate the class groups of $k$ and $S$).
This implies
\[
	\A_{l}^\times = \A_{l,S}^\times l^\times,
	\qquad
	\A_k^\times = \A_{k,S}^\times k^\times,
\]
and therefore
\[
	\Cl_{l} = \A_{l,S}^\times / \cO_{l,S}^\times, \qquad
	\Cl_{k} = \A_{k,S}^\times / \cO_{l,S}^\times.
\]
The big advantage of working with $\A_{l,S}^\times$ and $\cO_{l,S}$ instead of $\A_l^\times$ and
$l^\times$ is that $\A_{l,S}^\times$ and $\cO_{l,S}$ have well-defined Herbrand quotients,
whereas the cohomology groups of $\A_l^\times$ and $l^\times$ are infinite.





\section{The Herbrand quotient of the $S$-ideles}

Let $v$ be a place of $k$ and $\hat v$ a place of $l$ above $v$.
We'll write $D_{\hat v}$ the decomposition group at $\hat v$.
Then there are isomorphisms
\[
	\prod_{w | v} l_w^\times
	\cong
	\ind_{D_{\hat v}}^{\Gal(l/k)} l_{\hat v}^\times,
	\qquad
	\prod_{w | v} \cO_w^\times
	\cong
	\ind_{D_{\hat v}}^{\Gal(l/k)} \cO_{\hat v}^\times.
\]

\begin{lemma}
	There are isomorphisms
	\[
		H^n(l/k, \A_{S,l} ^\times)
		\cong
		\prod_{v \in S} H^n(l_{\hat v} / k_v, l_{\hat v}^\times).
	\]
\end{lemma}

\begin{lemma}
	If $l/k$ is a cyclic extension then we have
	\[
		h(l/k, \A_{S,l} ^\times )
		=
		\prod_{v \in S} |D_{\hat v}|.
	\]
\end{lemma}

\begin{proof}
	This follows from the previous lemma, Shapiro's lemma and the
	calculation of Herbrand quotients for local fields.
\end{proof}



\section{The Herbrand quotient of the $S$-units}

Define the \emph{logarithmic space} $V_S$ to be the following finite dimensional vector space
over the real numbers:
\[
	V_S = \prod_{v \in S} \prod_{w | v} \R.
\]
We consider $L_S$ as a representation of $\Gal(l/k)$, where the Galois action
permutes the places $w$ lying above each $v \in S$.
As a Galois representation we have
\[
	V_S \cong \prod_{v \in S} \ind_{D_{\hat v}}^{\Gal(l/k)} \R.
\]
Contained in $V_S$ we have a lattice $L_S$ consisting of vectors whose components are all in $\Z$.
Here we are using the word ``lattice'' to mean the $\Z$-space of a basis for $V_S$.
We have an isomorphism
\[
	L_S \cong \prod_{v \in S} \ind_{D_{\hat v}}^{\Gal(l/k)} \Z.
\]

\begin{lemma}
	If $l/k$ is a cyclic extension then
	$h(l/k,L_S) = \prod_{v \in S} |D_{\hat v}|$.
\end{lemma}

\begin{proof}
	This follows from Shapiro's lemma together with
	the calculation of the cohomology of a cyclic group with values in $\Z$.
\end{proof}

\begin{lemma}
	Let $l/k$ be cyclic and let $M$ be any Galois-invariant lattice in $V_S$.
	Then $h(l/k,M) = \prod_{v \in S} |D_{\hat v}|$
\end{lemma}

\begin{proof}
	The representations $M \otimes \Q$ and $L_S \otimes \Q$ have the same character
	(this is just the character of the representation $V_S$).
	Therefore the representations $M \otimes \Q$ and $L_S \otimes \Q$ are isomorphic.
	Hence $M$ is isomorphic to subrepresentation of finite index in $L_S$,
	so thay have the same Herbrand quotient.
\end{proof}


The vector $(1,1,\ldots,1) \in V_S$ in fixed by all elements of $\Gal(l/k)$, so it spans
a subrepresentation isomorphic to the trivial representation $\Z$.
Recall the we have a logarithmic map
\[
	\log_S : \cO_S^\times \to V_S,
\]
where the $w$-component of $\log_S(x)$ is $\log |x|_w$.
The kernel of $\log_S$ is the finite group of roots of unity in $k$.

\begin{theorem} \label{thm:Dirichlet unit theorem}
	$\log_S(\cO_S^\times)$ has zero intersection with $\Span (1,1,\ldots,1)$.
	The direct sum of these subrepresentations is a lattice in $V_S$.
\end{theorem}

\begin{corollary}
	Let $l/k$ be a cyclic extension. Then
	\[
		h(l/k,\cO_{l,S}^\times) = \frac{\prod_{v\in S} |D_{\hat v}|}{[l:k]}.
	\]
\end{corollary}

\begin{proof}
	Since $\log_S$ has finite kernel, the Herbrand quotient of $\cO_{l,S}^\times$ is
	equal to that of $\log_S(\cO_S^\times)$.
	By Dirichlet's unit theorem, $\log_S(\cO_S^\times) \oplus \Z$ is a lattice in
	$V_S$.
	We know the Herbrand quotient of $\log_S(\cO_S^\times) \oplus \Z$ from the calculation above,
	and the Herbrand quotient of $\Z$ is $[l:k]$.
\end{proof}

\begin{corollary}
	If $l/k$ is cyclic then $h(\A_{l,S}^\times / \cO_{l,S}^\times) = [l:k]$.
\end{corollary}




\section{Dirichlet Density}

\begin{definition} \label{def:Dirichlet density}
	Let $M$ be a set of primes of $\cO_k$.
	We'll say that $M$ has a \emph{Dirichlet density} $c \in \R$ if
	\[
		\sum_{P \in M} N(P)^{-s} \stackrel{s \to 1+}\sim c \log\frac{1}{s-1}
	\]
	where $s$ tends to $1$ through the real numbers $s>1$.
	The Dirichlet density, if it exists, will be written $\dir(M)$.
\end{definition}


\begin{lemma}
	Suppose $M_1$ and $M_2$ are disjoint sets of primes of $\cO_l$.
	If two of the sets $M_1, M_2, M_1 \cup M_2$ have a Dirichlet density, then so does the third
	and we have $\dir(M_1 \cup M_2) = \dir(M_1) + \dor(M_2)$.
\end{lemma}

\begin{proof}
	This is trivial.
\end{proof}

\begin{lemma} \label{lem:Dirichlet density top}
	The set of all primes of $\cO_k$ has Dirichlet density $1$.
\end{lemma}

\begin{proof}
	Let $P$ be a prime. We have
	\[
		\left|N(P)^-s - \log\left( \frac{1}{1-N(P)^-s}\right)\right| \ll N(P)^{-2s}
	\]
	Since $\sum N(P)^{-2s}$ is bounded in the region $s > 1$ (this follows from the convergence of the
	Dedekind zeta function), we have
	\[
		\sum_P N(P)^-s
		\sim
		\sum_P \log\left( \frac{1}{1-N(P)^-s} \right)
		=
		\log \zeta_l(s),
	\]
	where $\zeta_l$ is the Dedekind zeta function (\texttt{NumberField.dedekindZeta}).
	By the analytic class number formula (\texttt{NumberField.tendsto_sub_one_mul_dedekindZeta_nhdsGT})
	there is a positive real number $r$ such that
	\[
		\zeta_l(s) = \frac{r}{s-1} + O(1) \qquad (s > 1).
	\]
	This implies
	\[
		\log(\zeta_l(s)) \sim \log\left( \frac{1}{s-1}\right).
	\]
\end{proof}



\begin{lemma} \label{lem:Dirichlet density degree one}
	The set of primes of $\cO_l$ of degree one has Dirichlet density $1$.
\end{lemma}

\begin{proof}
	Let $M$ be the set of primes of degree larger than one. It's sufficient to
	prove that $M$ has Dirichlet density $0$.
	We have
	\[
		\sum_{P \in M} N(P)^-s
		= \sum_{n \in \N} A(n) n^-s,
	\]
	Where $A$ is the number of primes of degree $>1$ with norm $n$.
	Note that $A(n) \le [l:\Q]$. Also $A(n)=0$ unless $n=m^r$ for positive integer $m$ and
	$1 \le r \le [l:Q]$.
	This implies
	\[
		\sum_{P \in M} N(P)^-s
		\le [l:\Q] \sum_{r=2}^{[l:\Q]} \sum_{m =1} ^\infty m^{-rs}
		\le [l:\Q] (\zeta_\Q(2) + \cdots + \zeta_\Q([l:\Q]) ).
	\]
	Since the sum above is bounded, the set $M$ has Dirichlet density $0$.
\end{proof}


\begin{lemma} \label{lem:Dirichlet density split}
	Let $l/k$ be a finite Galois extension of number fields.
	Then the set of degree $1$ primes of $k$ which split completely in $l$
	has density $\frac{1}{[l:k]}$.
\end{lemma}

\begin{proof}
	Let $M_k$ be the set of degree $1$ primes of $k$ and $M_l$ the set of degree $1$ primes of $l$.
	Every prime $Q$ in $M_l$ lies above some prime $P \in M_k$.
	If there is a prime $Q$ above $P$, then there are precisely $[l:k]$ of them; this happens when $P$
	splits completely in $l$.

	Let $M$ be the set of $P \in M_k$ which split completely in $l$.
	Then we have
	\[
		\sum_{P \in M} N(P)^{-s}
		=
		\frac{1}{[l:k]} \sum_{Q \in M_l} N(Q)^{-s}
		\sim \frac{1}{[l:k]} \log\left( \frac{1}{s-1}\right).
	\]
	Here we have used \ref{lem:Dirichlet density degree one}.
\end{proof}





\section{The first inequality}

\begin{theorem} \label{thm:first inequality}
	\uses{lem:Dirichlet density split}
	For any finite Galois extension $l/k$ be have
	\[
		|H^0_{Tate}(l/k, \Cl_{l}) | \le [l : k].
	\]
\end{theorem}

\begin{proof}
	The easiest proof of this theorem is rather like that of Dirichlet's primes in arithmetic
	progressions result.
	We'll sketch the argument.

	One can easily show that $H^0_{Tate}(l/k, \Cl_{l})$ is finite.
	We have a function
	\[
		\textrm{primes in $\cO_{S,k}$} \to H^0_{Tate}(l/k, \Cl_{l}),
	\]
	which takes a prime $P$ to the coset of an idele, whose $P$ component is
	a uniformizer in $k_P$, and whose other components are $1$.
	This coset does not depend on the choice of uniformizer because $P$ is unramified in $l$
	(by choice of $S$), and therefore every element of $\cO_P^\times$ is a local norm in the extension.

	By the method of Dirichlet's primes in arithmetic progressions theorem, we may show that
	the images in $H^0_{Tate}(l/k, \Cl_{l})$ of the primes of $\cO_{k,S}$ are equidistributed, meaning
	that the set of primes in the preimage of an element of $H^0_{Tate}(l/k, \Cl_{l})$ has
	Dirichlet density $\frac{1}{|H^0_{Tate}(l/k, \Cl_{l})|}$.

	Let $P$ be a degree one prime which splits completely in $l$.
	Then the norm map $(l \otimes k_P)^\times \to k_P$ is surjective,
	and therefore the image of $P$ in $H^0_{Tate}(l/k, \Cl_{l})$ is $0$.
	We have shown in \ref{lem:Dirichlet density split} that the set of such primes has
	Dirichlet density $\frac{1}{[l:k]}$. It follows that
	\[
		\frac{1}{[l:k]} \le \frac{1}{|H^0_{Tate}(l/k, \Cl_{l})|}.
	\]
	This proves the result.
\end{proof}


\begin{corollary}
	If $l/k$ is cyclic then $|H^2(l/k, \Cl_{l,S})| = [l:k]$ and $H^1(l/k, \Cl_{l,S}) = 0$.
\end{corollary}

\begin{proof}
	This follows immediately from (a) the first inequality, (b) the periodicity of
	the cohomology for a cyclic group, and (c) the calculation of the Herbrand quotient
	of $\Cl_{l,S}$.
\end{proof}

\begin{proof}
	This follows immediately from (a) the first inequality, (b) the periodicity of
	the cohomology for a cyclic group, and (c) the calculation of the Herbrand quotient
	of $\Cl_{l,S}$.
\end{proof}

\begin{corollary}
	If $l/k$ is cyclic then $|H^2(l/k, \Cl_{l})| \le [l:k]$ and $H^1(l/k, \Cl_{l}) = 0$.
\end{corollary}

\begin{proof}
	This follows from the previous result, since $\Cl_l$ is the direct limit of
	the representations $\Cl_{l,S}$
\end{proof}


\begin{lemma}
	For any intermediate extension $l/m/k$, there is an isomorphism
	\[
		\Cl_{l}^{\Gal(l/m)} \cong \Cl_{m}.
	\]
\end{lemma}

\begin{proof}
	We have a short exact sequence
	\[
		0 \to \cO_{l}^\times \to \A_{l}^\times \to \Cl_{l} \to 0.
	\]
	Taking $\Gal(l/m)$-invariants we get a long exact sequence
	\[
		0 \to m^\times \to \A_{m}^\times \to \Cl_{l}^{\Gal(l/m)} \to
		H^1(l/m,l^\times).
	\]
	The result now follows from Hilbert's theorem 90.
\end{proof}

\begin{theorem}
	If $l/k$ is any finite Galois extension then $H^1(l/k, \Cl_{l}) = 0$
	and $|H^2(l/k, \Cl_{l})| \le [l:k]$.
\end{theorem}


\begin{proof}
	For each prime number $p$ dividing $[l:k]$ we let $k_p$ be the fixed
	field of a Sylow $p$-subgroup $S_p$ of $\Gal(l/k)$.
	By \ref{cor:cohomology sub Sylow}, it's suffient to prove
	\[
		H^1(l/k_p, \Cl_{l}) = 0, \qquad
		|H^2(l/k_p, \Cl_{l})| \le [l:k_p].
	\]
	Since $S_p$ is solvable, this reduces us to the case that $\Gal(l/k)$ is solvable.
	We'll prove the result by induction on $k$ starting with $k=l$ and working downwards
	in cyclic quotients.

	Clearly the result holds for $k=l$.
	Assume the result for a subfield $m$ of $l$ and let $m/k$ by cyclic.
	We have an inflationrestriction sequence:
	\[
		0 \to H^1(m/k, \Cl_{l}^{\Gal(l/m)}) \to H^1(l/k, \Cl_{l}) \to 0.
	\]
	By the lemma, we have an isomorphism
	\[
		H^1(m/k, \Cl_{m}) \cong H^1(l/k, \Cl_{l}) .
	\]
	The first term is zero since $m/k$ is cyclic.
	Therefore $H^1(l/k,\Cl_l)=0$.

	This implies that we have an inflation-restriction sequence
	\[
		0 \to H^2(m/k, \Cl_m) \to H^2(l/k, \Cl_l) \to H^2(l/m,\Cl_l).
	\]
	By the inductive hypothesis we have $|H^2(l/m,\Cl_l)| \le [l:m]$
	and since $l/m$ is cyclic we have $|H^2(m/k, \Cl_m)| \le [m : k]$.
	It follows that $|H^2(l/k,\Cl_l)| \le [l : k]$.
\end{proof}


To complete the construction of fundamental classes and the reciprocity isomorphism,
we need only show that there is an element in $H^2(l/k,\Cl_l)$ of order $[l:k]$.
Such an element is constructed first for a cyclic cyclotomic extension $l'/k$ with the same degree
as $l/k$.
It's then shown that the inflation of such a class to $ll'/k$ must split on $ll'/l$,
and must therefore be the inflation of an element of order $[l:k]$ in $H^2(l/k,\Cl_l)$.
